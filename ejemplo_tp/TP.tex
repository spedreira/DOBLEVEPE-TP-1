\documentclass[10pt,a4paper,fleqn]{article}

\input{AEDmacros}
\usepackage{caratula}
\usepackage{xcolor}
\usepackage{amssymb}
\usepackage{mathtools}

\titulo{Trabajo práctico 1: Especificación y WP}
\subtitulo{Segundo cuatrimestre de 2024}

\fecha{\today}

\materia{Algoritmos y Estructuras de Datos}
\grupo{Grupo DOBLEVEPE}

\integrante{Adra, Sofía Victoria}{71/24}{sofiavictoriaadra@gmail.com}
\integrante{Bermudez, Lucas Oscar}{124/24}{lucas.bermudez135@gmail.com}
\integrante{Pedreira, Santiago}{306/23}{spedreira.business@gmail.com}
\integrante{Troncoso, Fabian Lihuel}{379/24}{lihueltroncoso@gmail.com}
% Pongan cuantos integrantes quieran

% Declaramos donde van a estar las figuras
% No es obligatorio, pero suele ser comodo
\graphicspath{{../static/}}
\begin{document}

\maketitle

\section{Especificación}
\subsection{grandesCiudades}
\begin{proc}{grandesCiudades}{\In ciudades : \TLista{Ciudad}}{\TLista{Ciudad}}
    \requiere{True}
    \asegura{\paraTodo[unalinea]{x}{Ciudad}{x \in res \implica x \in ciudades \land x.habitantes > 50000 }}
\end{proc}


\subsection{sumaDeHabitantes}
\begin{proc}{sumaDeHabitantes}{\In menoresDeCiudades : \TLista{Ciudad}, \In mayoresDeCiudades : \TLista{Ciudad}}{\TLista{Ciudad}}
    \requiere{|menoresDeCiudades| = |mayoresDeCiudades| }
    \requiere{tienenMismosNombres(menoresDeCiudades, mayoresDeCiudades)}
    \asegura{|res| = |menoresDeCiudades|}
    \asegura{ tienenMismosNombres(res, menoresDeCiudades) }
    \asegura{\paraTodo[unalinea]{x}{Ciudad}{x \in res \implica \existe[unalinea]{i,j}{Ciudad}{i \in menoresDeCiudad \land  j \in mayoresDeCiudad} \land  x.nombre = i.nombre = j.nombre \land x.habitantes = i.habitantes + j.habitantes}}
\end{proc}

\pred{tienenMismosNombres}{ciudades1,ciudades2 : \TLista{Ciudad}}{\paraTodo[unalinea]{c}{Ciudad}{esCiudad(c,ciudades1) \iff esCiudad(c,ciudades2)}}

\pred{esCiudad}{c : Ciudad, ciudades : \TLista{Ciudad}}{\existe[unalinea]{e}{Ciudad}{e \in ciudades \land e.nombre = c.nombre}}



\subsection{hayCamino}

\begin{proc}{hayCamino}{\In distancias : \TLista{\TLista{\ent}}, \In desde : \ent, \In hasta : \ent}{Bool}
    \requiere{esMatrizCuadrada(distancias)\land esSimétrica(distancias) \land diagonalDeCeros(distancias)}
    \asegura{res = True \iff \existe[unalinea]{s}{\TLista{\ent}}{esUnCamino(s,distancias,desde,hasta}}
\end{proc}

    \pred{esMatriz}{m : \TLista{\TLista{\ent}}}{\paraTodo[unalinea]{a,b}{\TLista{\ent}}{(a \neq b \land a \in m \land b \in m ) \implica (\longitud a = \longitud b \land \longitud a > 0)}}

    \pred{esMatrizCuadrada}{m : \TLista{\TLista{\ent}}}{esMatriz(m) \land \paraTodo[unalinea]{s}{\TLista{\ent}}{s \in m \implica (\longitud s = \longitud m})}

    \pred{esSimétrica}{m : \TLista{\TLista{\ent}}}{esMatrizCuadrada(m) \yLuego \paraTodo[unalinea]{i,j}{\ent}{0 \leq i,j < \longitud m \implicaLuego (m[i][j] = m[j][i])}}

    \pred{diagonalDeCeros}{m : \TLista{\TLista{\ent}}}{esMatrizCuadrada(m) \yLuego \paraTodo[unalinea]{i}{\ent}{0 \leq i < \longitud m \implicaLuego (m[i][i] = 0)}}
    
%Arreglar la longitud de distancias
    \pred{hayCaminoDirecto}{distancias : \TLista{\TLista{\ent}}, desde : \ent, hasta : \ent}{(0 \leq desde,hasta < \longitud {distancias}) \yLuego (distancias[desde][hasta] \neq 0)}
    
%Arreglar lista vacia
    \pred {esUnCamino}{s : \TLista{\ent \times \ent}, distancias : \TLista{\TLista{\ent}}, desde : \ent, hasta : \ent}{(s \neq \listavacia) \yLuego (s[0]_0 = desde \land s[\longitud s -1]_1 = hasta) \land \paraTodo[unalinea]{i}{\ent}{0 \leq i < \longitud s -1 \implicaLuego (s[i]_1 = s[i+1]_0)} \land \paraTodo[unalinea]{i}{\ent}{0 \leq i < \longitud s \implicaLuego hayCaminoDirecto(distancias, s[i]_0, s[i]_1)}}
    
\subsection{cantidadCaminosNSaltos}
\begin{proc}{cantidadCaminosNSaltos}{\Inout conexión : \TLista{\TLista{\ent}}, \In n : \ent}{}
	\requiere {n > 0 \land conexión = $conexión_{0}$}
	\requiere {esMatrizCuadrada(conexión) \land esDeOrdenUno(conexión)}
	\asegura {\existe[unalinea]{s}{\TLista{\TLista{\TLista{\ent}}}}{|s| = n \yLuego sonMatricesHastaOrdenN(s, n, $conexión_{0}$) \yLuego conexión = s[|s| - 1]}}
\end{proc}

\pred{esDeOrdenUno}{m : \TLista{\TLista{\ent}}}{\paraTodo[unalinea]{i,j}{\ent}{0 \leq i,j < |m| \implicaLuego m[i][j] = 0 \lor m[i][j] = 1}}
\pred{sonMatricesHastaOrdenN}{s : \TLista{\TLista{\TLista{\ent}}}, n : \ent, m : \TLista{\TLista{\ent}}}{\paraTodo[unalinea]{i}{\ent}{0 < i < |s| \implicaLuego esProductoDeMatrices(s[i], s[i-1], m)}}
\pred{esProductoDeMatrices}{m,$m_{1},m_{2}$ : \TLista{\TLista{\ent}}}{\paraTodo[unalinea]{i,j}{\ent}{0 \leq i,j < |m| \implicaLuego m[i][j] = \sum\limits_{k=0}^{|m| - 1} m_{1}[i][k] * m_{2}[k][j]}}

\subsection{caminoMinimo}

\begin{proc}{caminoMinimo}{\In origen : \ent, \In destino: \ent, \In distancias : \TLista{\TLista{\ent}}}{\TLista{\ent}}
	
	%    Requiere del ejercicio
	\requiere{esMatrizCuadrada(distancias) \land esSimetrica(distancias) \land todosNoNegativos(distancias) \\ \land diagonalDeCeros(distancias)}
	
	% Asegura de mi ejercicio
	\asegura{res \neq  \listavacia \iff (\existe[unalinea]{s}{\TLista{\ent \times \ent}}{esElCaminoMinimo(s, distancias, origen, destino) \land (res[0] = s[0] _0) \land (res[|res| - 1] = s[|s|-1] _1) \land \paraTodo[unalinea]{i}{\ent}{0 \leq i < |s| - 1 \implicaLuego res[i+1] = s[i] _1}})}
	
\end{proc}
% Funcion auxiliar sumaDistancias
%Arreglar suma
\aux{sumaDistancias}{s: \TLista{\ent \times \ent}}{\ent}{$\sum_{i = 0}^{|s|-1}$ s[i]_0 + s[i]_1}

% Predicado esElCaminoMinimo
\pred{esElCaminoMinimo}{s: \TLista{\ent \times \ent}, distancias: \TLista{\TLista{\ent}, origen: \ent, destino: \ent}}{(esUnCamino(s, distancias, origen, destino)) \land \paraTodo[unalinea]{i}{\TLista{\ent \times \ent}}{esUnCamino(i, distancias, origen, destino) \implicaLuego sumaDistancias(s) \leq sumaDistancias(i)}}

\pred{todosNoNegativos}{m: \TLista{\TLista{\ent}}}{\paraTodo[unalinea]{s}{\TLista{\ent}}{s \in m \implica (\paraTodo[unalinea]{n}{\ent}{n \in s \implica n \geq 0)}}}

\section{Demostraciones de correctitud}

% Defino las variables aca para reutilizar mas adelante
\newcommand{\invariante}[1]{0 \leq #1 \leq |ciudades| \yLuego res = \sum\limits_{j=0}^{#1 - 1} ciudades[j].habitantes}

\subsection{Introducción}

Para demostrar la correctitud del programa en base a la especificación, se utilizará la lógica de la tripla de Hoare:
\begin{align*}
    \{P\} S \{Q\}
    \shortintertext{\parbox{\textwidth}{\centering \textit {\footnotesize {Donde P es la precondición del programa, S el programa y Q la postcondición.}}}}
\end{align*}
\indent
En esta lógica, S es correcto para P y Q si y sólo si P implica la precondicion más débil de S para Q.
Es decir:
\begin{align*}
    \{P\} S \{Q\} \iff P \implica WP(S, Q)
\end{align*}
\indent
Como el programa contiene un ciclo, para simplificar la demostración, se dividirá en tres partes.
En primer lugar, se comprobará que: 
\begin{align}
    P \implica WP(S_{1}, Pc)
    \label{eq:1}
    \shortintertext{\parbox{\textwidth}{\centering \textit {\footnotesize {Donde P es la precondición del programa, $S_{1}$ la parte del programa previa al ciclo y Pc la precondición del ciclo.}}}} \notag
\end{align}
\indent
Luego:
\begin{align}
    Pc \implica WP(Sc, Qc)
    \label{eq:2}
    \shortintertext{\parbox{\textwidth}{\centering \textit {\footnotesize {Donde Pc es la precondición del ciclo, Sc la parte del programa a ejecutar dentro del ciclo y Qc la postcondición del ciclo.}}}} \notag
\end{align}
\indent
Y finalmente:
\begin{align}
    Qc \implica WP(S_{2}, Q)
    \label{eq:3}
    \shortintertext{\parbox{\textwidth}{\centering \textit {\footnotesize {Donde Qc es la postcondición del ciclo, $S_{2}$ la parte del programa posterior al ciclo y Q la postcondición del programa.}}}} \notag
\end{align}
\indent
Se definen las variables P, Q, Pc, Qc, I, B y la función Fv, que serán utilizadas a lo largo de la demostración:
\begin{align*}
    P &= \{ \existe[unalinea]{j}{\ent}{0 \leq i < |ciudades| \yLuego ciudades[j]}\\
    &\land \paraTodo[unalinea]{j}{\ent}{0 \leq j < |ciudades| \implicaLuego ciudades[j].habitantes \geq 0}\\
    &\land \paraTodo[unalinea]{k, h}{\ent}{0 \leq k < h < |ciudades| \implicaLuego ciudades[k].nombre \neq ciudades[h].nombre} \}\\
    Q &= \{ res = \sum\limits_{j=0}^{|ciudades| - 1} ciudades[j].habitantes \land i = |ciudades| \}\\
    Pc &= \{ res = 0 \land i = 0 \}\\
    Qc &= \{ res = \sum\limits_{j=0}^{|ciudades| - 1} ciudades[j].habitantes \land i = |ciudades| \}\\
    I &= \{\invariante{i}\}\\
    B &= \{ i < |ciudades| \}\\
    Fv(i) &= |ciudades| - i
\end{align*}

\subsection{Demostración}

Comenzamos probando (1):
\begin{align*}
    P &\implica WP(res:=0;i:=0, Pc)\\
    &\qquad\qquad\iff \text{por axioma 3}\\
    P &\implica WP(res:=0, WP(i:=0, Pc))\\
    &\qquad\qquad\iff\\
    P &\implica WP(res:=0, WP(i:=0, \{ res = 0 \land i = 0 \}))\\
    &\qquad\qquad\iff \text{por axioma 1}\\
    P &\implica WP(res:=0, \{ def(0) \yLuego  Pc_0^i \})\\
    &\qquad\qquad\iff\\
    P &\implica WP(res:=0, \{ def(0) \yLuego  res = 0 \land 0 = 0 \})\\
    &\qquad\qquad\iff\\
    P &\implica WP(res:=0, \{ true \yLuego res = 0 \land 0 = 0 \})\\
    &\qquad\qquad\iff\\
    P &\implica WP(res:=0, \{ res = 0 \land true \})\\
    &\qquad\qquad\iff\\
    P &\implica WP(res:=0, \{ res = 0 \})\\
    q &= \{ res = 0 \}\\
    &\qquad\qquad\iff \text{por axioma 1}\\
    P &\implica WP(res:=0, \{ def(0) \yLuego  q_0^{res} \})\\
    &\qquad\qquad\iff\\
    P &\implica \{ true \land 0 = 0 \}\\
    &\qquad\qquad\iff\\
    P &\implica \{ true \}\\
    \shortintertext{\parbox{\textwidth}{\centering \small {Que es tautología, por lo que queda probado.}}} \notag
\end{align*}
\indent
Continuamos con (3):
\begin{align*}
    Qc &\implica Q
    \shortintertext{\parbox{\textwidth}{\centering \small {Es clara la implicancia pues la postcondición del ciclo y la del programa son idénticas.}}} \notag
\end{align*}
\indent
Finalmente (2) se demostrará con la correctitud del ciclo, primero con el teorema del invariante y luego con el teorema de terminación del ciclo.\\
\indent
Teorema del invariante:\\
\begin{align*}
    &a.\quad Pc \implica I\\
    &b.\quad \{ I \land B \} \quad Sc \quad \{ I \}\\
    &c.\quad I \land \neg B \implica Qc\\
\end{align*}
\indent
La proposición (a), se prueba de la siguiente manera:
\begin{align*}
    &\{ res = 0 \land i = 0 \} \implica \{\invariante{i}\} \equiv \\
    \shortintertext{\parbox{\textwidth}{\centering \small {Como se trata de una implicancia analizamos el caso en que el antecedente es verdadero, entonces res = 0 y i = 0 valen para I}}} \notag
    &\equiv\{ res = 0 \land i = 0 \} \implica \{ \invariante{0} \} \equiv\\
    \shortintertext{\parbox{\textwidth}{\centering \small {El rango negativo para la sumatoria la reduce a 0}}} \notag
    &\equiv\{ res = 0 \land i = 0 \} \implica \{ 0 = 0 \leq |ciudades| \yLuego 0 = 0 \} \equiv\\
    &\equiv\{ res = 0 \land i = 0 \} \implica \{ 0 \leq |ciudades| \yLuego true \} \equiv\\
    &\equiv\{ res = 0 \land i = 0 \} \implica \{ 0 \leq |ciudades| \} \equiv\\
    \shortintertext{\parbox{\textwidth}{\centering \small {Como la longitud de ciudades como mínimo es 0, esto también vale}}} \notag
    &\equiv\{ res = 0 \land i = 0 \} \implica \{ true \} \\
    \shortintertext{\parbox{\textwidth}{\centering \small {Y finalmente esta expresión es tautología}}} \notag
\end{align*}
\indent
La proposición (b), se prueba de la siguiente manera:
\begin{align*}
    \shortintertext{\parbox{\textwidth}{\centering \small {La tripla de Hoare es verdadera si y sólo si}}} \notag
    \{I \land B \}\\
     \implica \\
     WP(Sc, I)\\
     \shortintertext{\parbox{\textwidth}{\centering \small {Se calcula la WP como}}} \notag
	W_{1} \equiv WP(res := res + ciudades[i].habitantes ; i := i+1 , I)
	\shortintertext{\parbox{\textwidth}{\centering \small {Por axioma 3 se tiene}}}
	W_{1} \equiv WP(res := res + ciudades[i].habitantes, WP(i := i+1, I))
	\shortintertext{\parbox{\textwidth}{\centering \small {Se calcula el WP anidado}}}
	W_{2} \equiv WP(i := i+1, I))
	\shortintertext{\parbox{\textwidth}{\centering \small {Por axioma 1}}}
	W_{2} \equiv \{ def(i+1) \yLuego I_{i+1}^{i} \}
	\shortintertext{\parbox{\textwidth}{\centering \small {Luego}}}
	W_{2} \equiv \{ true \yLuego \invariante{i+1} \}
	\shortintertext{\parbox{\textwidth}{\centering \small {Que es equivalente a}}}
	W_{2} \equiv \{ -1 \leq i < |ciudades| \yLuego res = \sum\limits_{j=0}^{i} ciudades[j].habitantes \}
	\shortintertext{\parbox{\textwidth}{\centering \small {Ahora se puede volver a calcular W1, por axioma 1}}}
	W_{1} \equiv \{ def(res + ciudades[i].habitantes) \yLuego W_{2 res + ciudades[i].habitantes}^{res} \}
	\shortintertext{\parbox{\textwidth}{\centering \small {Evaluando}}}
	W_{1} \equiv \{ 0 \leq i < |ciudades| \yLuego -1 \leq i < |ciudades| \yLuego res + ciudades[i].habitantes = \sum\limits_{j=0}^{i} ciudades[j].habitantes \}
	\shortintertext{\parbox{\textwidth}{\centering \small {Se opera de la siguiente forma}}}
	W_{1} \equiv \{ 0 \leq i < |ciudades| \yLuego -1 \leq i < |ciudades| \yLuego res = \sum\limits_{j=0}^{i} ciudades[j].habitantes - ciudades[i].habitantes \}
	\shortintertext{\parbox{\textwidth}{\centering \small {Como ciudades[i].habitantes es el ultimo termino de la sumatoria}}}
	W_{1} \equiv \{ 0 \leq i < |ciudades| \yLuego -1 \leq i < |ciudades| \yLuego res = \sum\limits_{j=0}^{i-1} ciudades[j].habitantes \}
	\shortintertext{\parbox{\textwidth}{\centering \small {Ahora, para el rango de i queda el más fuerte, es decir}}}
	W_{1} \equiv \{ 0 \leq i < |ciudades| \yLuego res = \sum\limits_{j=0}^{i-1} ciudades[j].habitantes \}
	\shortintertext{\parbox{\textwidth}{\centering \small {Retomando la implicación de la tripla de Hoare de la proposición (b), ya se puede reemplazar la WP por $W_{1}$}}}
	\{(\invariante{i}) \land i < |ciudades| \}\\
	\implica \\
	\{ 0 \leq i < |ciudades| \yLuego res = \sum\limits_{j=0}^{i-1} ciudades[j].habitantes \}
	\shortintertext{\parbox{\textwidth}{\centering \small {De la misma forma que se operó anteriormente, para el rango de i queda lo más fuerte}}}
	\{ 0 \leq i < |ciudades| \yLuego res = \sum\limits_{j=0}^{i-1} ciudades[j].habitantes \}\\
	\implica \\
	\{ 0 \leq i < |ciudades| \yLuego res = \sum\limits_{j=0}^{i-1} ciudades[j].habitantes \}
	\shortintertext{\parbox{\textwidth}{\centering \small {Como ambos términos son iguales, es tautología, por lo que queda probada la tripla de Hoare}}}
\end{align*}
\indent
La proposición (c), se prueba de la siguiente manera:
\begin{align*}
    \{ \invariante{i} \land i \geq |ciudades| \}\\
     \implica \\
    \{ res = \sum\limits_{j=0}^{|ciudades| - 1} ciudades[j].habitantes \land i = |ciudades| \}\\
     \shortintertext{\parbox{\textwidth}{\centering \small {Se unifica el rango de i que queda como}}} \notag
     \{ res = \sum\limits_{j=0}^{i - 1} ciudades[j].habitantes \land i = |ciudades| \}\\
     \implica \\
    \{ res = \sum\limits_{j=0}^{|ciudades| - 1} ciudades[j].habitantes \land i = |ciudades| \}\\
\shortintertext{\parbox{\textwidth}{\centering \small {Como se trata de una implicancia analizamos el caso en que el antecedente es verdadero, entonces se puede reemplazar $|ciudades|$ por i}}} \notag
     \{ res = \sum\limits_{j=0}^{i - 1} ciudades[j].habitantes \land i = |ciudades| \}\\
     \implica \\
    \{ res = \sum\limits_{j=0}^{i - 1} ciudades[j].habitantes \land i = |ciudades| \}\\
	\shortintertext{\parbox{\textwidth}{\centering \small {Como ambos términos son iguales, es tautología}}}
\end{align*}
\indent
Al haberse probado (a), (b), (c) queda demostrado que el ciclo es parcialmente correcto por el teorema del invariante. Ahora, para terminar de probar (2), se demostará la finalización del ciclo con el teorema de terminación:
\begin{align*}
    &d.\quad \{ I \land B \land fv = V_{0} \}\quad Sc \quad\{ fv < V_{0} \} \\
    &e.\quad \{ I \land fv \leq 0 \} \implica \neg B\\
\end{align*}
\indent
La proposición (d), se prueba de la siguiente manera:
\begin{align*}
    \shortintertext{\parbox{\textwidth}{\centering \small {La tripla de Hoare es verdadera si y sólo si}}} \notag
    \{I \land B \land fv = V_{0} \}\\
     \implica \\
     WP(Sc, F)\\
     \shortintertext{\parbox{\textwidth}{\centering \small {Con F =  \{fv $<$ $V_{0}$\}}}} \notag
	\shortintertext{\parbox{\textwidth}{\centering \small {Se calcula la WP como}}} \notag
	W_{1} \equiv WP(res := res + ciudades[i].habitantes ; i := i+1 , F)
	\shortintertext{\parbox{\textwidth}{\centering \small {Por axioma 3 se tiene}}}
	W_{1} \equiv WP(res := res + ciudades[i].habitantes, WP(i := i+1, F))
	\shortintertext{\parbox{\textwidth}{\centering \small {Se calcula el WP anidado}}}
	W_{2} \equiv WP(i := i+1, F))
	\shortintertext{\parbox{\textwidth}{\centering \small {Por axioma 1}}}
	W_{2} \equiv \{ def(i+1) \yLuego F_{i+1}^{i} \}
	\shortintertext{\parbox{\textwidth}{\centering \small {Luego}}}
	W_{2} \equiv \{ true \yLuego |ciudades| - i - 1 < V_{0} \}
	\shortintertext{\parbox{\textwidth}{\centering \small {Finalmente}}}
	W_{2} \equiv \{ |ciudades| - i - 1 < V_{0} \}
	\shortintertext{\parbox{\textwidth}{\centering \small {Ahora se puede volver a calcular W1, por axioma 1}}}
	W_{1} \equiv \{ def(res + ciudades[i].habitantes) \yLuego W_{2 res + ciudades[i].habitantes}^{res} \}
	\shortintertext{\parbox{\textwidth}{\centering \small {Evaluando}}}
	W_{1} \equiv \{ true \yLuego |ciudades| - i - 1 < V_{0} \}
	\shortintertext{\parbox{\textwidth}{\centering \small {Entonces}}}
	W_{1} \equiv \{ |ciudades| - i - 1 < V_{0} \}
	\shortintertext{\parbox{\textwidth}{\centering \small {Retomando la implicación de la tripla de Hoare de la proposición (d), ya se puede reemplazar la WP por $W_{1}$}}}
	\{I \land B \land fv = V_{0} \}\\
     \implica \\
      \{ |ciudades| - i - 1 < V_{0} \}\\
\shortintertext{\parbox{\textwidth}{\centering \small {Si la primera parte de la implicación es verdadera, se puede reemplazar $V_{0}$ por fv}}}
	\{I \land B \land fv = V_{0} \}\\
     \implica \\
      \{ |ciudades| - i - 1 < fv \}\\
\shortintertext{\parbox{\textwidth}{\centering \small {Evaluando}}}
	\{I \land B \land fv = V_{0} \}\\
     \implica \\
      \{ |ciudades| - i - 1 < |ciudades| - i \}\\
\shortintertext{\parbox{\textwidth}{\centering \small {Operando la desigualdad, puedo restar a ambos lados por $|ciudades| - i$ }}}
	\{I \land B \land fv = V_{0} \}\\
     \implica \\
      \{ - 1 < 0 \}\\
\shortintertext{\parbox{\textwidth}{\centering \small {Luego}}}
	\{I \land B \land fv = V_{0} \}\\
     \implica \\
      \{ true \}\\
\shortintertext{\parbox{\textwidth}{\centering \small {Que es tautología}}}
\end{align*}
\indent
La proposición (e), se prueba de la siguiente manera:
\begin{align*}
    \{ I \land |ciudades| - i \leq 0 \} \implica i \geq |ciudades|
    \shortintertext{\parbox{\textwidth}{\centering \small {Si la primera parte de la implicación es verdadera, se puede ver que  $|ciudades| - i \leq 0$ es verdadero, entonces como}}}
    |ciudades| - i \leq 0 \equiv i \geq |ciudades|
    \shortintertext{\parbox{\textwidth}{\centering \small {Tenemos finalmente}}}
	\{ I \land |ciudades| - i \leq 0 \} \implica true
 \shortintertext{\parbox{\textwidth}{\centering \small {Que es tautología}}}
\end{align*}
\indent
Al haberse probado (d) y (e) queda demostrado que el ciclo finaliza por el teorema de finalización, y por lo tanto, como ya se probó el teorema del invariante, queda probado (2).

\indent
En conclusión, por monotonía, al haber probado (1), (2) y (3) queda demostrada la correctitud del programa según la lógica de la tripla de Hoare.
\subsection{}
Para demostrar que el valor devuelto es mayor a 50.000, definimos una nueva postcondición del programa. 
\vspace{2,5mm}\\
Q \equiv \{ res = $\small \displaystyle \sum_{j=0}^{|ciudades|-1} ciudades[j].habitantes \land res >$ 50.000 \} \equiv \{$\small \displaystyle \sum_{j=0}^{|ciudades|-1} ciudades[j].habitantes >$ 50.000 \}\\
Debemos probar la validez de la tripla de Hoare \{P\}S\{Q\}, para eso probaremos:
\begin{enumerate}
    \item P \implica wp($S_1;S_2, P_c$)
    \item $P_c$ \implica wp(while...,$Q_c$)
    \item $Q_c$ \implica Q
\end{enumerate}
Por monotonía, esto nos permite demostrar que P \implica wp(S,Q) es verdadera. Definimos una nueva precondición y postcondición del ciclo, e invariante.

$Q_c \equiv \{\small \displaystyle \sum_{j=0}^{|ciudades|-1} ciudades[j].habitantes > 50.000 \}$\\

$P_c \equiv \{ \existe[unalinea]{k}{\ent}{0 \leq k< |ciudades| \yLuego ciudades[k].habitantes >  50.000 }\land \\ \paraTodo[unalinea]{j}{\ent}{0    \leq j < |ciudades| \implicaLuego ciudades[j].habitantes \geq 0} \land res=0 \land i=0 \}$\\

$I \equiv \{ 0 \leq i \leq |ciudades| \yLuego (res = \small \displaystyle \sum_{j=0}^{i-1} ciudades[j].habitantes) \land \ \existe[unalinea]{k}{\ent}{0 \leq k< |ciudades| \yLuego ciudades[k].habitantes >  50.000 }\land \\ \paraTodo[unalinea]{j}{\ent}{0    \leq j < |ciudades| \implicaLuego ciudades[j].habitantes \geq 0} \}$

\item 1) P \implica $wp(S_1;S_2, P_c$)\\ \vspace{-10mm}

\begin{eqnarray}
    wp(S_1;S_2, P_c) &\overset{Ax3}{\equiv}& wp(S_1; wp(S_2,\ P_c))  \notag \\
    &\equiv& wp(S_1, wp(i:=0,\ P_c)) \notag \\
    &\overset{Ax1}{\equiv}& wp(S_1, def(0) \yLuego \text{$P_c$}_{0}^{i}) \notag \\
    &\equiv& wp(S_1, True \yLuego \existe[unalinea]{k}{\ent}{0 \leq k< |ciudades| \yLuego ciudades[k].habitantes >  50.000 }\land \notag \\ & & \paraTodo[unalinea]{j}{\ent}{0\leq j < |ciudades| \implicaLuego ciudades[j].habitantes \geq 0}\ \land \ res=0\ \land \ \textcolor{blue}{0=0}) \notag \\
     &\equiv& wp(res:= 0, \existe[unalinea]{k}{\ent}{0 \leq k< |ciudades| \yLuego ciudades[k].habitantes >  50.000 }\land \notag \\ & & \paraTodo[unalinea]{j}{\ent}{0\leq j < |ciudades| \implicaLuego ciudades[j].habitantes \geq 0}\ \land \ res=0\ \land \ \textcolor{blue}{True}) \notag \\
     &\overset{Ax1}{\equiv}& \existe[unalinea]{k}{\ent}{0 \leq k< |ciudades| \yLuego ciudades[k].habitantes >  50.000 }\land \notag \\ & & \paraTodo[unalinea]{j}{\ent}{0\leq j < |ciudades| \implicaLuego ciudades[j].habitantes \geq 0}\ \land \ \textcolor{blue}{0=0})) \notag \\
       wp(S_1;S_2, P_c) &\equiv& \existe[unalinea]{k}{\ent}{0 \leq k< |ciudades| \yLuego ciudades[k].habitantes >  50.000 }\land \notag \\ & & \paraTodo[unalinea]{j}{\ent}{0\leq j < |ciudades| \implicaLuego ciudades[j].habitantes \geq 0} \notag 
\end{eqnarray}
Luego, P \implica \ $wp(S_1;S_2, P_c$) es cierto pues ambos cuantificadores están idénticos en la WP y P. 

\item 2) $P_c$\implica \ $wp(while...,Q_c$)\\
Debemos probar la correctitud y terminación del ciclo.
\item 1.\ $P_c\implica I$ \\

\begin{itemize}
    \item \parbox[t]{\textwidth}{ Ambos cuantificadores, \existe[unalinea]{k}{\ent}{0 \leq k< |ciudades| \yLuego ciudades[k].habitantes >  50.000 } y \\ \paraTodo[unalinea]{j}{\ent}{0\leq j < |ciudades| \implicaLuego ciudades[j].habitantes \geq 0}están idénticos en I y P_c} 
    \item \parbox[t]{\textwidth}{res = 0 \land \ i = 0 \implica res = $\small \displaystyle \sum_{j=0}^{i-1} ciudades[j].habitantes$ = $\small \displaystyle \sum_{j=0}^{-1} ciudades[j].habitantes$ = 0 por el rango vacío }
     \item \parbox[t]{\textwidth}{i = 0 \implica \ 0 \leq 0 \leq |ciudades|}
\end{itemize}
\item 2.\ $\{I \land B\}S_c\{I\}$  \\Para probar que la tripla de Hoare es válida, vemos que $\{I \land B\} \implica wp(S_c,I)$ sea cierto.
El cuerpo del ciclo tiene dos instrucciones, que llamaremos $S_c1$ y $S_c2$. 

\begin{eqnarray}
    wp(S_c1;S_c2, I) &\overset{Ax3}{\equiv}& wp(S_c1, wp(S_c2, I)) \notag \\
     &\equiv&  wp(S_c1, wp(i:= i+1, I))\notag \\
      &\overset{Ax1}{\equiv}& wp(S_c1,def(i+1) \yLuego I_{i}^{i+1})\notag \\
      &\equiv&  wp(S_c1, (def(i) \land def(1)) \yLuego 0 \leq \textcolor{blue}{i+1} \leq |ciudades| \yLuego (res = \small \displaystyle \sum_{j=0}^{\textcolor{blue}{i+1}-1} ciudades[j].habitantes \land \notag \\ & & \existe[unalinea]{k}{\ent}{0 \leq k< |ciudades| \yLuego ciudades[k].habitantes >  50.000 }\land \notag \\ & & \paraTodo[unalinea]{j}{\ent}{0\leq j < |ciudades| \implicaLuego ciudades[j].habitantes \geq 0})) \notag \\
       &\equiv& wp(res:= res + ciudades[i].habitantes, (True \land True) \yLuego \ 0 \leq i+1 \leq |ciudades| \ yLuego \notag \\ & & (res = \small \displaystyle \sum_{j=0}^{i} ciudades[j].habitantes \land \notag \\ & & \existe[unalinea]{k}{\ent}{0 \leq k< |ciudades| \yLuego ciudades[k].habitantes >  50.000 }\land \notag \\ & & \paraTodo[unalinea]{j}{\ent}{0\leq j < |ciudades| \implicaLuego ciudades[j].habitantes \geq 0})) \notag \\
       &\overset{Ax1}{\equiv}& ((def(res) \land def(ciudades) \land def(i))\yLuego 0 \leq i < |ciudades|) \yLuego (0 \leq i+1 \leq |ciudades|) \ \land \notag  \\ & & \textcolor{blue}{res + ciudades[i].habitantes} = \small \displaystyle \sum_{j=0}^{i} ciudades[j].habitantes \land \\ & & \existe[unalinea]{k}{\ent}{0 \leq k< |ciudades| \yLuego ciudades[k].habitantes >  50.000 }\land \notag \\ & & \paraTodo[unalinea]{j}{\ent}{0\leq j < |ciudades| \implicaLuego ciudades[j].habitantes \geq 0} \notag \\
        &\equiv& (0 \leq i < |ciudades| \ \land \ 0 \leq i+1 \leq |ciudades|) \ \yLuego (res= \small \displaystyle \sum_{j=0}^{i-1} ciudades[j].habitantes \land \\ & & \existe[unalinea]{k}{\ent}{0 \leq k< |ciudades| \yLuego ciudades[k].habitantes >  50.000 }\land \notag \\ & & \paraTodo[unalinea]{j}{\ent}{0\leq j < |ciudades| \implicaLuego ciudades[j].habitantes \geq 0}) \notag \\
        wp(S_c1;S_c2, I)  &\equiv& (0 \leq i <|ciudades|) \yLuego (res= \small \displaystyle \sum_{j=0}^{i-1} ciudades[j].habitantes \land \notag \\ & & \existe[unalinea]{k}{\ent}{0 \leq k< |ciudades| \yLuego ciudades[k].habitantes >  50.000 }\land \notag \\ & & \paraTodo[unalinea]{j}{\ent}{0\leq j < |ciudades| \implicaLuego ciudades[j].habitantes \geq 0}) \notag 
\end{eqnarray}
(1) Si despejamos: $res = \small \displaystyle \sum_{j=0}^{i} ciudades[j].habitantes \ - ciudades[i].habitantes = \small \displaystyle \sum_{j=0}^{i-1} ciudades[j].habitantes$\\
(2) $(0 \leq i < |ciudades| \ \land \ 0 \leq i+1 \leq |ciudades|)\equiv(0 \leq i < |ciudades| \ \land \ -1 \leq i \leq |ciudades|-1)\\
\implica 0 \leq i <|ciudades|$\\
Ahora vemos la implicación: \\
\begin{itemize}
    \item \parbox[t]{\textwidth}{$I \land \ B \implica 0 \leq i \leq |ciudades| \land i < |ciudades| \implica 0 \leq i < |ciudades|$}
    \item \parbox[t]{\textwidth}{Tanto la sumatoria como los cuantificadores están idénticos en I y WP.}
\end{itemize}

\item 3. $I \land \neg B \implica Q_c$\\
\begin{eqnarray}
    I \land \neg B &\equiv& 0 \leq i \leq |ciudades| \yLuego (res = \small \displaystyle \sum_{j=0}^{i-1} ciudades[j].habitantes \land \notag \\ & &\existe[unalinea]{k}{\ent}{0 \leq k< |ciudades| \yLuego ciudades[k].habitantes >  50.000 }\land \notag \\ & & \paraTodo[unalinea]{j}{\ent}{0\leq j < |ciudades| \implicaLuego ciudades[j].habitantes \geq 0}) \land \neg(i<|ciudades|) \\
    &\equiv& i=|ciudades| \yLuego (res = \small \displaystyle \sum_{j=0}^{i-1} ciudades[j].habitantes \land \notag \\ & &\existe[unalinea]{k}{\ent}{0 \leq k< |ciudades| \yLuego ciudades[k].habitantes >  50.000 }\land \notag \\ & & \paraTodo[unalinea]{j}{\ent}{0\leq j < |ciudades| \implicaLuego ciudades[j].habitantes \geq 0}) \notag 
 \end{eqnarray}
 (3) $0 \leq i \leq |ciudades| \land \neg(i<|ciudades|)\equiv 0 \leq i \leq |ciudades| \land i\geq |ciudades| \implica i = |ciudades|$\\
 Veamos la implicación:
\begin{itemize}
    \item \parbox[t]{\textwidth}{Como asumimos el antecedente $I \land \neg B$ cierto, podemos reemplazar en la sumatoria.\\ res = $\small \displaystyle \sum_{j=0}^{\textcolor{blue}{|ciudades|}-1} ciudades[j].habitantes$\\
    Además, si reescribimos la sumatoria: \\
    res = $\small \displaystyle \sum_{j=0}^{k-1} ciudades[j].habitantes \ + ciudades[k].habitantes + \small \displaystyle \sum_{j=k+1}^{|ciudades|-1} ciudades[j].habitantes$\\
    De esta forma, sabemos por asumir el antecedente verdadero:\\
    \paraTodo[unalinea]{j}{\ent}{0\leq j < |ciudades| \implicaLuego (ciudades[j].habitantes \geq 0 \land \\ \existe[unalinea]{k}{\ent}{0 \leq k< |ciudades| \yLuego (ciudades[k].habitantes >  50.000 \land \\res = $\small \displaystyle \sum_{j=0}^{k-1} ciudades[j].habitantes \ + ciudades[k].habitantes + \small \displaystyle \sum_{j=k+1}^{|ciudades|-1} ciudades[j].habitantes$)})} \\\\ }
    Veamos que los limites de las sumatorias nunca se indefinen:
    \item \parbox[t]{\textwidth}{Como $k <|ciudades| \implica k-1<|ciudades|$ se ve que nunca se indefine ningun termino de la sumatoria. \\
    \paraTodo[unalinea]{j}{\ent}{0\leq j < |ciudades| \implicaLuego ciudades[j].habitantes \geq 0} \implica  \displaystyle \sum_{j=0}^{k-1} ciudades[j].habitantes \geq 0}
     \item \parbox[t]{\textwidth}{Como $0\leq k \implica 0\leq k+1, y \ k<|ciudades| \implica k+1\leq|ciudades|$, se ve que nunca se indefine ningun termino de \\ la sumatoria(a lo mucho el rango es vacío si $k+1= |ciudades|$). \\
      \paraTodo[unalinea]{j}{\ent}{0\leq j < |ciudades| \implicaLuego ciudades[j].habitantes \geq 0} \implica  \displaystyle \sum_{j=k+1}^{|ciudades|-1} ciudades[j].habitantes \geq 0}
       \item \parbox[t]{\textwidth}{Así, si vale $I \land \neg B$:\\
       \implica res \geq 0 +  ciudades[k].habitantes + 0 \\
       Y como \existe[unalinea]{k}{\ent}{0 \leq k< |ciudades| \yLuego (ciudades[k].habitantes >  50.000 \land \\res = $\small \displaystyle \sum_{j=0}^{k-1} ciudades[j].habitantes \ + ciudades[k].habitantes + \small \displaystyle \sum_{j=k+1}^{|ciudades|-1} ciudades[j].habitantes$)} \\
       \implica \ $res > 50.000 \equiv $\small \displaystyle \sum_{j=0}^{|ciudades|-1} ciudades[j].habitantes > 50.000$ }
\end{itemize}
Así, $I \land \neg B \implica Q_c$ es cierto\\
\item 4. $\{I \land B \land fv=v_0\}S_c\{fv<v_0\}$\\Para probar que la tripla de Hoare es válida, vemos que $(I \land B \land fv=v_0) \implica wp(S_c,fv<v_0)$ sea cierto.\\
\begin{eqnarray}
    wp(S_c1;S_c2, fv<v_0) &\overset{Ax3}{\equiv}& wp(S_c1, wp(S_c2, fv<v_0)) \notag \\
     &\equiv&  wp(S_c1, wp(i:= i+1, \textcolor{blue}{|ciudades|-i < v_0}))\notag \\
    &\overset{Ax1}{\equiv}& wp(S_c1, def(i+1) \yLuego (|ciudades|- (\textcolor{blue}{i+1}) < v_0)) \notag \\
    &\equiv& wp(res:= res + ciudades[i].habitantes, (def(i) \land def(1)) \yLuego (|ciudades| -i - 1 < v_0)\notag \\
    &\overset{Ax1}{\equiv}& (def(res) \land def(ciudades) \land def(i))\yLuego 0 \leq i < |ciudades| \yLuego (|ciudades| -i -1 < v_0) \notag \\
    wp(S_c1;S_c2, fv<v_0) &\equiv& 0 \leq i < |ciudades| \land |ciudades| -i -1 < v_0 \notag 
\end{eqnarray}
Ahora vemos la implicación: \\
\begin{itemize}
    \item \parbox[t]{\textwidth}{$(I \land B \land fv=v_0) \implica 0 \leq i \leq |ciudades| \ \land \ i < |ciudades|\ \implica 0 \leq i < |ciudades| $}
    \item \parbox[t]{\textwidth}{$(I \land B \land fv=v_0) \implica |ciudades|-1=v_0 \implica |ciudades| -i -1 < v_0 = |ciudades| -i -1 < \textcolor{blue}{|ciudades| -i} \Leftrightarrow -1<0$}
\end{itemize}
\item 5. $I \land fv\leq 0 \implica \neg B$
\begin{itemize}
    \item \parbox[t]{\textwidth}{I \land fv\leq 0 \implica 0\leq i \leq |ciudades| \land \textcolor{blue}{|ciudades|-i\leq 0} \equiv 0 \leq i \leq|ciudades| \land |ciudades| \leq i \implica i=|ciudades|\\ \implica \neg(i<|caminos|)\equiv\neg B}
\end{itemize}

Al probar la correctitud y terminación del ciclo, probamos $P_c$\implica \ $wp(while...,Q_c$).\\
\item 3) $Q_c \implica Q$\\
Es clara la implicancia pues la postcondición del ciclo y la del programa son idénticas.
\end{document}
